<?phprequire_once "class_orders.php";//подключение класса Заказыrequire_once "class_order_switchers.php";//подключение класса Заказанные переключатели$order = new  ClassOrders();//создание объекта класса ClassOrders$orderswitcher = new  ClassOrderSwitchers();//создание объекта класса ClassOrderSwitchers	if(!isset($_COOKIE["idorder"]) || $_COOKIE["idorder"] == -1){//если заказ не существует открыть новый заказ		$order->addNewOrder();//создание нового заказа		setcookie("idorder", $order->maxid());//запись в cookie номера текущего заказа	}$mode = $_COOKIE["construct_mode"];//new - создание нового; режим view - просмотр; edit - редактирование//if($mode == "new") $idorderswitcher = $_COOKIE["id_order_switcher"];//если новый переключатель//else $idorderswitcher = $_GET["idorderswitch"];//если ранее введенный переключатель?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>  <title>Конструктор переключателя</title><meta http-equiv="Content-type" content="text/html; charset=utf8"/><meta name="Keywords" content="Конструктор переключателя, конфигуратор переключателя" /><meta name="Description" content="On-line разработка переключателя по техническим требованиям заказчика" /><meta name="Author" content="Дмитрий Коржов" /><link href="/images/icon1.ico" rel="shortcut icon" type="image/x-icon" /><link  rel="stylesheet" type="text/css" href="/styles/styles.css" /></head>  <body>  <?php require_once "../../blocks/header.html";?> <div id = "content" >  <?php require_once "../../blocks/left_panel.html";?>   <div id = "main_content"> <?php if($_COOKIE["construct_mode"] == "edit"): ?><h1>Редактор переключателя</h1> <?php elseif($_COOKIE["construct_mode"] == "view"): ?><h1>Просмотр переключателя</h1><?php else: ?><h1>Конструктор переключателя</h1><?php endif; ?><center><h3>Разработанный Вами переключатель</h3><?php$nameswitcher = "S".$orderswitcher->read("current")."J";//наименование переключателяif($orderswitcher->read("handle") != "key") {//если не ключ 	if($orderswitcher->read("moment") == 1) $nameswitcher.="V";//добавление самовозврата$fix = 	$orderswitcher->read("fix");//вариант крепленияif($fix == "_") $fix = "";//удаление _ для варианта крепления на переднюю панель или дверь$nameswitcher .= $fix;//добавление варианта крепленияif($orderswitcher->read("handle") == "ur" || $orderswitcher->read("handle") == "ub" ) $nameswitcher .= "U";//если ручка U elseif($orderswitcher->read("board") == 1) $nameswitcher .= "D";//добавление табличкиif($orderswitcher->read("ip54") == 1) $nameswitcher .= "G";//добавления уплотнения по оси}else$nameswitcher .= "K";//если ключ$nameswitcher .= $orderswitcher->read("nscheme");//добавление номера схемы$nameswitcher .= $orderswitcher->read("initpos");//добавление начального положения$nameswitcher .= substr($orderswitcher->read("angle"),0,1);//добавление углаif($orderswitcher->read("handle") == "red") $nameswitcher .= "R";//если ручка красная if($orderswitcher->read("handle") == "ub") $nameswitcher .= "B";//если ручка "U" чернаяif($orderswitcher->read("handle") == "t") $nameswitcher .= "T";//если ручка специальной формыif($orderswitcher->read("moment") == 1 && $orderswitcher->read("qpos") == 3) $nameswitcher .= "/".$orderswitcher->read("momentfrom");//добавление варианта самовозврата для трех положенийif($orderswitcher->read("fix") == "B") $nameswitcher .= "L=".$orderswitcher->read("length");//добавление длины оси для варианта "B"$nameswitcher = str_replace("CXC", "XC", $nameswitcher);$nameswitcher = str_replace("CC", "C", $nameswitcher);$orderswitcher->write("nameswitcher", $nameswitcher);//запись в БД наименования переключателяecho("<h2>".$nameswitcher."</h2>");//вывод наименования переключателя$nscheme = $orderswitcher->read("nscheme");if(preg_match("/temp/",$nscheme , $q)){$nscheme = trim($nscheme, "(");$nscheme = trim($nscheme, "*");$nscheme = trim($nscheme, ")");echo("<p  style='text-align: left; color: green;'>* Введенная Вами диаграмма замыканий отсутствует в нашей базе схем. Поэтому ей присвоен временный номер <b>".$nscheme."</b>. После заказа переключателя временный номер будет заменен на постоянный.</p></br>");}echo("имеет следущие технические характеристики:");//$nscheme = $orderswitcher->read("nscheme");if (preg_match("/^220[1-9]C/",$nscheme) || preg_match("/^221[0-2]C/",$nscheme)) $orderswitcher->write("mark", "1$0$2$");if (preg_match("/^240[1-6]C/",$nscheme)) $orderswitcher->write("mark", "2$1$0$3$4$");if (preg_match("/^260[1-4]C/",$nscheme)) $orderswitcher->write("mark", "3$2$1$0$4$5$6$");if (preg_match("/^280[1-3]C/",$nscheme)) $orderswitcher->write("mark", "4$3$2$1$0$5$6$7$8$");if (preg_match("/^400[1-2]C/",$nscheme)) $orderswitcher->write("mark", "5$4$3$2$1$0$6$7$8$9$10$");//Вывод параметров переключателяecho("</br></br>");echo("<p  style='text-align: left;'>- максимальный коммутируемый переменный ток ".$orderswitcher->read("current")." А ");if($mode != "view") echo("<a href='constr_switcher1.php' style='color: red;'>изменить</a></p>");	if($orderswitcher->read("handle") == "black") $handle = "черная ручка";	if($orderswitcher->read("handle") == "red") $handle = "красная ручка";	if($orderswitcher->read("handle") == "t") $handle = "рукоятка";	if($orderswitcher->read("handle") == "ur") $handle = "красная ручка с возможностью фиксации навесным замком";	if($orderswitcher->read("handle") == "ub") $handle = "черная ручка с возможностью фиксации навесным замком";	if($orderswitcher->read("handle") == "key") $handle = "ключ";echo("<p  style='text-align: left;'>- ручка управления: ".$handle." ");if($mode != "view") echo("<a href='constr_switcher2.php' style='color: red;'>изменить</a></p>");if($orderswitcher->read("board") == 1) $inf_board = "- с лицевой панелью ";else $inf_board = "- без лицевой панели ";if($orderswitcher->read("handle") != "ur" && $orderswitcher->read("handle") != "ub" && $orderswitcher->read("handle") != "key"){echo("<p  style='text-align: left;'>".$inf_board." ");if($mode != "view") echo("<a href='constr_switcher3.php' style='color: red;'>изменить</a></p>");}if($orderswitcher->read("ip54") == 1) $ip54 = "- с уплотнением по оси до IP54 ";else $ip54 = "- без уплотнения по оси до IP54 ";echo("<p  style='text-align: left;'>".$ip54." ");if($mode != "view" && $orderswitcher->read("handle") != "key") echo("<a href='constr_switcher4.php' style='color: red;'>изменить</a></p>");	if($orderswitcher->read("fix") == "_") $fix = "на переднюю панель или дверь ";	if($orderswitcher->read("fix") == "O") $fix = "на монтажную панель ";	if($orderswitcher->read("fix") == "L") $fix = "на DIN-рейку ";	if($orderswitcher->read("fix") == "P") $fix = "в коробке с IP54 ";	if($orderswitcher->read("fix") == "B") $fix = "переключатель крепится на монтажную панель, а ручка - на дверь ";	echo("<p  style='text-align: left;'>- крепление: ".$fix." ");if($mode != "view" && $orderswitcher->read("handle") != "key") echo("<a href='constr_switcher5.php' style='color: red;'>изменить</a></p>");	if($orderswitcher->read("fix") == "B"){echo("<p  style='text-align: left;'>- расстояние от монтажной панели до двери: ".$orderswitcher->read('length')." мм ");if($mode != "view") echo("<a href='constr_switcher5a.php' style='color: red;'>изменить</a></p>");}echo("<p  style='text-align: left;'>- количество положений ручки: ".$orderswitcher->read('qpos')." ");if($mode != "view") echo("<a href='constr_switcher6.php' style='color: red;'>изменить</a></p>");echo("<p  style='text-align: left;'>- количество контактных групп: ".$orderswitcher->read('qcont')." ");if($mode != "view") echo("<a href='constr_switcher6.php' style='color: red;'>изменить</a></p>");	if($orderswitcher->read("moment") == 1) $momentary = "- с самовозвратом ";	else $momentary = "- без самовозврата ";echo("<p  style='text-align: left;'>".$momentary." ");if($mode != "view" && $orderswitcher->read("handle") != "key" && $orderswitcher->read("handle") != "ub" && $orderswitcher->read("handle") != "ur") echo("<a href='constr_switcher8.php' style='color: red;'>изменить</a></p>");echo("<p  style='text-align: left;'>- угол поворота ручки: ".(360/$orderswitcher->read('angle'))." градусов ");	if($orderswitcher->read("qpos") < 7)if($mode != "view") echo("<a href='constr_switcher9.php' style='color: red;'>изменить</a></p>");echo("<p  style='text-align: left;'>- начальное положение ");if($mode != "view" && $orderswitcher->read("handle") != "key") echo("<a href='constr_switcher10.php' style='color: red;'>изменить</a></p>");echo("<img class = 'img'   src = 'initial_position.php?initpos=".$orderswitcher->read("initpos")."'  height = '200px'  alt = V>");echo("<p  style='text-align: left;'>- номер схемы: ".$nscheme." ");if($mode != "view") echo("<a href='constr_switcher6.php' style='color: red;'>изменить</a></p>");//echo("<img  style = 'margin-left: 5px; margin-top: 5px; ' src = 'outInputScheme.php' alt = 'схема переключателя' />");$get = "qpos=".$orderswitcher->read('qpos');$get .= "&qcont=".$orderswitcher->read('qcont');$get .= "&closdiag=".$orderswitcher->read('closdiag');$get .= "&qjump=".$orderswitcher->read('qjump');$get .= "&jump=".$orderswitcher->read('jump');$get .= "&mark=".$orderswitcher->read('mark');$get .= "&board=".$orderswitcher->read('board');echo("<img  style = 'margin-left: 5px; margin-top: 5px; ' src = 'outscheme.php?".$get."' alt = 'схема переключателя' /></br>");$get .= "&current=".$orderswitcher->read('current');$get .= "&handle=".$orderswitcher->read('handle');$get .= "&fix=".$orderswitcher->read('fix');$get .= "&ip54=".$orderswitcher->read('ip54');$get .= "&moment=".$orderswitcher->read('moment');$get .= "&length=".$orderswitcher->read('length');$get .= "&initpos=".$orderswitcher->read('initpos');$get .= "&angle=".$orderswitcher->read('angle');echo"<br><p  style='text-align: left;'>Габаритный чертеж переключателя</p><br>";echo("<img  style = 'margin-left: 5px; margin-top: 5px; ' src = '../../switcher/drawing_switcher.php?".$get."' width='100%' alt = 'чертеж переключателя' /></br>");?>	</br></br><p>Вы можете указать дополнительные требования, например, "Установить удлиненные крепежные винты".</p><form name = 'form11' action = 'add_switcher_order.php'  method = 'get'><table border="0" width = "auto" cellpadding="4" cellspacing="10" style = 'text-align: right;' ><tr>	<td><p><b>Дополнительные требования</b></p>	</td></tr><tr>	<td><textarea name = "addfield" id = 'text'  rows = "4" cols = "70"><?=$orderswitcher->read("addfield")?> </textarea>	</td></tr></table></br><?php if($_COOKIE["construct_mode"] == "new"): ?><p>Если Вы хотите преобрести этот переключатель, введите количество и нажмите кнопку "Добавить в заказ".</p><?php endif; ?></br>	<?php if($_COOKIE["construct_mode"] != "view"): ?>Количество <input type = 'text' name = 'quantity' value='<?=$orderswitcher->read("quantity")?>' size='3'/><?php endif; ?>		<input type = 'submit'   value = ' <?php if($_COOKIE["construct_mode"] != "new"): ?>Вернуться на страницу просмотра заказа<?php else: ?>Добавить в заказ<?php endif; ?>'/></form></center>	</div> </div>	 <div class="clear"></div> <?php require_once "../../blocks/footer.html";?> </body></html>